name: Deploy Pages

on:
  # –≤—Ä—É—á–Ω—É—é
  workflow_dispatch: {}
  # –∞–≤—Ç–æ-–¥–µ–ø–ª–æ–π –ø—Ä–∏ –∫–æ–º–º–∏—Ç–µ –≤ main –∏–º–µ–Ω–Ω–æ –ø–æ —Ñ–∞–π–ª–∞–º —Å–∞–π—Ç–∞
  push:
    branches: [ main ]
    paths:
      - 'index.html'
      - 'article.html'
      - 'frontend/**'
      - 'assets/**'
      - 'css/**'
      - 'js/**'
      - '.github/workflows/pages.yml'
  # –∑–∞–ø–∞—Å–Ω–æ–π —Ç—Ä–∏–≥–≥–µ—Ä ‚Äî –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è ingest
  workflow_run:
    workflows: ["Ingest & Publish"]
    types: [completed]

# –ø—Ä–∞–≤–∞ –¥–ª—è pages
permissions:
  contents: read
  pages: write
  id-token: write

# –æ–¥–∏–Ω –¥–µ–ø–ª–æ–π –∑–∞ —Ä–∞–∑
concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      # –ï—Å–ª–∏ —É —Ç–µ–±—è –±–∏–ª–¥-—Ñ–∞–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –ø—Ä–æ—Å—Ç–æ —É–ø–∞–∫—É–µ–º —Ç–µ–∫—É—â–∏–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.
      # –ï—Å–ª–∏ –µ—Å—Ç—å —Å–±–æ—Ä–∫–∞ (npm build –∏ —Ç.–ø.), –≤—Å—Ç–∞–≤—å –µ—ë —Ç—É—Ç –∏ –º–µ–Ω—è–π path –Ω–∏–∂–µ –Ω–∞ –ø–∞–ø–∫—É –±–∏–ª–¥–∞.
      - name: Upload site artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: .         # üî¥ –í–ê–ñ–ù–û: –∫–æ—Ä–µ–Ω—å —Ä–µ–ø–æ; –≤–∫–ª—é—á–∞–µ—Ç frontend/data/news.json

  deploy:
    needs: build
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
