<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Видео — СпецТрейлеры</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Golos+Text:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles/tokens.css">
  <link rel="stylesheet" href="styles/base.css">
  <link rel="stylesheet" href="styles/components.css">
</head>
<style>
  .video-card { display:block; border:1px solid #eee; border-radius:12px; overflow:hidden; background:#fff; }
  .video-card .thumb { width:100%; aspect-ratio:16/9; object-fit:cover; display:block; }
  .video-card .body { padding:10px 12px; }
  .video-card .title { font-size:14px; font-weight:600; line-height:1.3; margin-bottom:6px; }
  .video-card .meta { font-size:12px; color:#666; display:flex; gap:8px; flex-wrap:wrap; }

  .pager { display:flex; gap:8px; flex-wrap:wrap; margin:16px 0 24px }
  .pager a, .pager span { padding:6px 10px; border:1px solid #ddd; border-radius:8px; text-decoration:none; font-size:14px; }
  .pager .active { background:#111; color:#fff; border-color:#111; cursor:default }
  .pager .disabled { opacity:.5; pointer-events:none }
</style>
<body>
<header class="header">
  <div class="container header-inner">
    <a class="logo" href="./">
      <svg viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M3 16h14l3-6h-7l-2 4H3v2Z" stroke="currentColor" stroke-width="1.5"/><circle cx="7" cy="18" r="2" fill="currentColor"/><circle cx="17" cy="18" r="2" fill="currentColor"/></svg>
      <span>СпецТрейлеры</span>
    </a>
    <nav class="nav">
      <a href="./">Новости</a>
      <a href="legislation.html">Законодательство / ГОСТы</a>
      <a href="guides.html">Гайды и регламенты</a>
      <a class="active" href="videos.html">Видео</a>
    </nav>
  </div>
</header>

<section class="hero container">
  <h1>Видео</h1>
  <p class="sub">YouTube, VK Видео, RuTube, Dzen — подборки по отрасли</p>
</section>

<main class="container">
  <div class="list" id="video-list"></div>
  <nav id="pager-v" class="pager"></nav>
</main>

<footer class="footer">
  <div class="container">Видео материалы принадлежат их авторам. Мы показываем только публичные публикации с открытых платформ.</div>
</footer>
<script type="module" src="js/videos.js"></script>
<script>
(function(){
  const qs=(s,r=document)=>r.querySelector(s);
  const STATE={ all:[], page:1, perPage:Infinity }; // ← по умолчанию показываем все

  function getIntParam(name, def){
    const u=new URL(location.href), v=parseInt(u.searchParams.get(name),10);
    return Number.isFinite(v)&&v>0?v:def;
  }
  function setParam(name,val){
    const u=new URL(location.href);
    if(val==null) u.searchParams.delete(name); else u.searchParams.set(name,String(val));
    history.replaceState({}, "", u.toString());
  }
  function fmtDateTime(x){
    const d=new Date(x||Date.now()); if(isNaN(d)) return '';
    const dd=String(d.getDate()).padStart(2,'0'), mm=String(d.getMonth()+1).padStart(2,'0'),
          yy=d.getFullYear(), hh=String(d.getHours()).padStart(2,'0'), mi=String(d.getMinutes()).padStart(2,'0');
    return `${dd}.${mm}.${yy}, ${hh}:${mi}`;
  }
  function ytThumb(u){try{
    let m=/[?&]v=([A-Za-z0-9_-]{6,})/.exec(u); if(m) return `https://img.youtube.com/vi/${m[1]}/hqdefault.jpg`;
    m=/youtu\.be\/([A-Za-z0-9_-]{6,})/.exec(u); if(m) return `https://img.youtube.com/vi/${m[1]}/hqdefault.jpg`;
  }catch(e){} return ''; }
  function paginate(arr,page,per){
    if(!Number.isFinite(per)) return {page:1,pages:1,total:arr.length,items:arr};
    const total=arr.length, pages=Math.max(1,Math.ceil(total/per));
    const p=Math.min(Math.max(1,page),pages), start=(p-1)*per;
    return {page:p,pages,total,items:arr.slice(start,start+per)};
  }
  function renderPager(total,page,per,mount){
    if(!Number.isFinite(per)){ mount.innerHTML=''; return; } // показываем все — без пагинации
    const pages=Math.max(1,Math.ceil(total/per)); if(pages<=1){mount.innerHTML=''; return;}
    const btn=(t,p,dis,act)=>act?`<span class="active">${t}</span>`:dis?`<span class="disabled">${t}</span>`:`<a href="#" data-p="${p}">${t}</a>`;
    const parts=[];
    parts.push(btn("«",Math.max(1,page-1),page<=1,false));
    const w=3, s=Math.max(1,page-w), e=Math.min(pages,page+w);
    if(s>1) parts.push(btn("1",1,false,page===1),"<span>…</span>");
    for(let i=s;i<=e;i++) parts.push(btn(String(i),i,false,i===page));
    if(e<pages) parts.push("<span>…</span>",btn(String(pages),pages,false,page===pages));
    parts.push(btn("»",Math.min(pages,page+1),page>=pages,false));
    mount.innerHTML=parts.join(" ");
    mount.onclick=e=>{
      const a=e.target.closest('a[data-p]'); if(!a) return; e.preventDefault();
      const next=parseInt(a.dataset.p,10); if(!Number.isFinite(next)) return;
      STATE.page=next; setParam('page',next); paint();
    };
  }
  function card(it){
    const href=it.url||'#', title=it.title||'',
          src=(it.source&&it.source.name)||new URL(href,location.href).hostname||'Источник',
          date=fmtDateTime(it.published_at),
          thumb=it.thumbnail||ytThumb(href)||'';
    return `
      <a class="video-card" href="${href}" target="_blank" rel="noopener">
        ${thumb?`<img class="thumb" src="${thumb}" alt="${title}">`:``}
        <div class="body">
          <div class="title">${title}</div>
          <div class="meta"><span>${src}</span>${date?`<span>• ${date}</span>`:``}</div>
        </div>
      </a>`;
  }
  function paint(){
    const perParam=getIntParam('per',STATE.perPage); // ?per=24 для страниц
    STATE.perPage=perParam;
    const list=STATE.all;
    STATE.page=getIntParam('page',1);
    const {items,page,pages,total}=paginate(list,STATE.page,STATE.perPage);
    console.log(`[videos] total=${total}, render=${items.length}, page=${page}/${pages}, per=${STATE.perPage}`);
    const mount=document.getElementById('video-list');
    mount.innerHTML=items.map(card).join('');
    renderPager(total,page,STATE.perPage,document.getElementById('pager-v'));
  }
  async function load(){
    const res=await fetch('./data/videos.json');
    const data=await res.json();
    const arr=Array.isArray(data)?data:(data.items||[]);
    console.log('[videos] loaded', arr.length);
    STATE.all=arr; paint();
  }
  load();
})();
</script>

</body>
</html>
