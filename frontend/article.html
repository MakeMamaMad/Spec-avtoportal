<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Статья — СпецТрейлеры</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    .container{max-width:980px;margin:0 auto;padding:24px}
    .title{font:800 32px/1.2 system-ui;margin:6px 0 16px}
    .meta{color:#6b7280;font:500 13px/1 system-ui;margin-bottom:16px}
    .cover{border-radius:16px;overflow:hidden;background:#f3f5f7}
    .cover img{width:100%;height:auto;display:block}
    .content{font:17px/1.65 system-ui;color:#111827;margin:20px 0}
    .actions{display:flex;gap:12px;margin:28px 0}
    .btn{appearance:none;border:0;border-radius:10px;padding:10px 16px;font:600 14px/1 system-ui;cursor:pointer}
    .btn--ghost{background:#f3f4f6}
    .btn--primary{background:#111827;color:#fff}
    /* скрываем ВЕРХНИЕ кнопки, если вдруг останутся в DOM */
    .actions.top{display:none!important}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <a href="index.html" class="logo" style="text-decoration:none;color:#111827;font:700 18px system-ui">СпецТрейлеры</a>
    </header>

    <h1 id="title" class="title"></h1>
    <div id="meta" class="meta"></div>

    <figure class="cover" id="cover"></figure>

    <div id="content" class="content"></div>

    <!-- ЕДИНСТВЕННЫЙ блок действий – внизу -->
    <div class="actions">
      <a id="backBtn" class="btn btn--ghost" href="index.html">← Вернуться к новостям</a>
      <a id="sourceBtn" class="btn btn--primary" target="_blank" rel="noopener">Читать в источнике</a>
    </div>
  </div>

  <script>
    const q = (s, r=document)=>r.querySelector(s);
    const params = new URLSearchParams(location.search);
    const byId = (id)=>q('#'+id);

    // грузим список локально (как и на главной)
    async function loadNews() {
      const resp = await fetch('./data/news.json', {cache:'no-store'});
      return await resp.json();
    }

    function pickImage(n) {
      return n.image || n.img || (Array.isArray(n.images) ? n.images[0] : '') || '';
    }

    function renderArticle(n){
      byId('title').textContent = n.title || '';
      byId('meta').textContent  = [n.domain || n.source, n.published_at].filter(Boolean).join(' • ');

      const img = pickImage(n);
      byId('cover').innerHTML = img ? `<img src="${img}" alt="" loading="lazy">` : '';

      // контент: сначала полный, иначе summary
      const html = (n.content_html && n.content_html.trim()) ||
                   (n.summary && `<p>${n.summary}</p>`) || '';
      byId('content').innerHTML = html;

      // кнопка "источник"
      const u = n.link || params.get('u') || '';
      const sourceBtn = byId('sourceBtn');
      if (u) { sourceBtn.href = u; }
      else { sourceBtn.style.display = 'none'; }
    }

    (async function init(){
      const id = params.get('id');
      const u = params.get('u');
      const list = await loadNews();
      let item = null;

      if (id) item = list.find(n => (n.id || '') === id);
      if (!item && u) item = list.find(n => (n.link || '') === decodeURIComponent(u));

      if (!item) {
        byId('title').textContent = 'Статья не найдена';
        byId('content').innerHTML = '<p>Попробуйте вернуться на главную страницу.</p>';
        byId('sourceBtn').style.display = 'none';
        return;
      }
      renderArticle(item);
    })();
  </script>
  <script src="./js/news.js?v=2025-11-10-12-35"></script>
</body>
</html>
